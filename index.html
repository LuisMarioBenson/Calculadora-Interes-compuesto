<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Interés Compuesto</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- GSAP (Animation) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Anime.js (Animation) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <!-- ApexCharts (Graphs) -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- Hover.css (Button Effects) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css" />

    <!-- SheetJS (Excel Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        /* Custom styling for form inputs */
        .form-input, .form-select {
            @apply w-full p-3 bg-white border border-gray-300 rounded-lg shadow-sm transition duration-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        /* Custom card styling */
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg;
        }
        /* Intro animation styling */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0c4a6e; /* Dark blue */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            font-size: 2rem;
            text-align: center;
            overflow: hidden;
        }
        .char {
            transform: translateY(115px);
            transition: transform .5s;
        }
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Pantalla de Introducción con GSAP -->
    <div id="intro-screen">
        <h1 id="intro-text" class="font-bold text-3xl md:text-5xl lg:text-6xl px-4">Inversiones Tempranas</h1>
    </div>

    <!-- Contenedor Principal de la Aplicación -->
    <main id="app-container" class="opacity-0 min-h-screen p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-blue-800">Calculadora de Interés Compuesto</h1>
                <p class="text-gray-600 mt-2">Visualiza el crecimiento de tu dinero a lo largo del tiempo.</p>
            </header>

            <!-- Grid Principal: Controles y Gráfica -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 mb-8">
                
                <!-- Columna de Controles (Izquierda) -->
                <div class="lg:col-span-2 card">
                    <form id="calculator-form">
                        <h2 class="text-xl font-bold mb-4 text-blue-700">Configura tu Inversión</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="initial-investment" class="form-label">Inversión Inicial ($)</label>
                                <input type="number" id="initial-investment" class="form-input" placeholder="Ej: 1000" min="0" value="1000">
                            </div>
                            <div>
                                <label for="monthly-contribution" class="form-label">Aportación Mensual ($)</label>
                                <input type="number" id="monthly-contribution" class="form-input" placeholder="Ej: 100" min="0" value="100">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="investment-period" class="form-label">Plazo</label>
                                    <input type="number" id="investment-period" class="form-input" placeholder="Ej: 10" min="1" value="10">
                                </div>
                                <div>
                                    <label for="period-unit" class="form-label">Unidad</label>
                                    <select id="period-unit" class="form-select">
                                        <option value="years" selected>Años</option>
                                        <option value="months">Meses</option>
                                        <option value="weeks">Semanas</option>
                                        <option value="days">Días</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="interest-rate" class="form-label">Tasa de Interés Anual (%)</label>
                                    <input type="number" id="interest-rate" class="form-input" placeholder="Ej: 7" min="0" value="7">
                                </div>
                                <div>
                                    <label for="compound-frequency" class="form-label">Interés se compone</label>
                                    <select id="compound-frequency" class="form-select">
                                        <option value="yearly">Anual</option>
                                        <option value="monthly" selected>Mensual</option>
                                        <option value="weekly">Semanal</option>
                                        <option value="daily">Diario</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Columna de Gráfica (Derecha) -->
                <div class="lg:col-span-3 card">
                    <h2 class="text-xl font-bold mb-4 text-blue-700">Proyección de Crecimiento</h2>
                    <div id="chart"></div>
                </div>
            </div>

            <!-- Sección de Resultados y Tabla -->
            <div class="card">
                <div class="flex flex-wrap justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-blue-700">Resultados Detallados</h2>
                    <div class="flex space-x-2 mt-4 md:mt-0">
                        <button id="clear-button" class="hvr-wobble-vertical flex items-center bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition duration-300">
                            <span class="material-symbols-outlined mr-2">delete_sweep</span>
                            Limpiar
                        </button>
                        <button id="export-button" class="hvr-wobble-vertical flex items-center bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                            <span class="material-symbols-outlined mr-2">download</span>
                            Exportar a Excel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table id="results-table" class="w-full text-left">
                        <thead class="bg-blue-50">
                            <tr>
                                <th class="p-3 text-sm font-semibold tracking-wide">Periodo</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-right">Aportado</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-right">Interés Ganado</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-right">Balance Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las filas se generarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Errores -->
    <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <span class="material-symbols-outlined text-5xl text-red-500 mb-4">error</span>
            <h3 class="text-lg font-bold mb-2">Error en los Datos</h3>
            <p id="error-message" class="text-gray-600 mb-4">Por favor, revisa los valores ingresados.</p>
            <button id="close-modal-button" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Entendido</button>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- INTRO ANIMATION ---
        function runIntroAnimation() {
            const introText = document.getElementById('intro-text');
            const appContainer = document.getElementById('app-container');
            
            // Split text into characters
            introText.innerHTML = introText.textContent.replace(/\S/g, "<span class='char'>$&</span>");
            
            gsap.timeline()
                .to('.char', { y: 0, stagger: 0.05, delay: 0.2, duration: 0.1 })
                .to('#intro-screen', { 
                    y: '-100%', 
                    duration: 1, 
                    ease: 'power2.inOut', 
                    delay: 1 
                })
                .to(appContainer, { 
                    opacity: 1, 
                    duration: 0.5 
                }, "-=0.5")
                .set('#intro-screen', { display: 'none' });
        }

        // --- DOM ELEMENTS ---
        const form = document.getElementById('calculator-form');
        const initialInvestmentEl = document.getElementById('initial-investment');
        const monthlyContributionEl = document.getElementById('monthly-contribution');
        const investmentPeriodEl = document.getElementById('investment-period');
        const periodUnitEl = document.getElementById('period-unit');
        const interestRateEl = document.getElementById('interest-rate');
        const compoundFrequencyEl = document.getElementById('compound-frequency');
        const tableBody = document.querySelector('#results-table tbody');
        const clearButton = document.getElementById('clear-button');
        const exportButton = document.getElementById('export-button');
        const errorModal = document.getElementById('error-modal');
        const errorMessageEl = document.getElementById('error-message');
        const closeModalButton = document.getElementById('close-modal-button');

        // --- APEXCHART CONFIGURATION ---
        const chartOptions = {
            chart: {
                type: 'area',
                height: 350,
                toolbar: { show: true },
                zoom: { enabled: true }
            },
            series: [{
                name: 'Balance Total',
                data: []
            }, {
                name: 'Total Aportado',
                data: []
            }],
            xaxis: {
                type: 'category',
                categories: [],
                labels: {
                    formatter: function(val) {
                        return `Año ${val}`;
                    }
                }
            },
            yaxis: {
                labels: {
                    formatter: (value) => `$${formatCurrency(value)}`
                }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth', width: 2 },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                    stops: [0, 90, 100]
                }
            },
            tooltip: {
                x: {
                    format: 'dd MMM yyyy'
                },
                y: {
                    formatter: (value) => `$${formatCurrency(value)}`
                }
            },
            colors: ['#2563eb', '#9ca3af'], // Blue and Gray
            legend: {
                position: 'top',
                horizontalAlign: 'left'
            }
        };
        const chart = new ApexCharts(document.querySelector("#chart"), chartOptions);
        chart.render();

        // --- EVENT LISTENERS ---
        form.addEventListener('input', handleCalculation);
        clearButton.addEventListener('click', resetForm);
        exportButton.addEventListener('click', exportToExcel);
        closeModalButton.addEventListener('click', () => errorModal.classList.add('hidden'));

        // --- HELPER FUNCTIONS ---
        const formatCurrency = (num) => {
            if (isNaN(num)) return '0.00';
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        const showError = (message) => {
            errorMessageEl.textContent = message;
            errorModal.classList.remove('hidden');
        };

        // --- CORE CALCULATION LOGIC ---
        function calculateCompoundInterest() {
            const initial = parseFloat(initialInvestmentEl.value) || 0;
            const monthlyContribution = parseFloat(monthlyContributionEl.value) || 0;
            let period = parseInt(investmentPeriodEl.value);
            const periodUnit = periodUnitEl.value;
            const annualRate = parseFloat(interestRateEl.value) / 100 || 0;
            const compoundFrequency = compoundFrequencyEl.value;
            
            // Validation
            if (period <= 0 || annualRate < 0 || initial < 0 || monthlyContribution < 0) {
                showError('Por favor, ingresa valores positivos y un plazo mayor a cero.');
                return null;
            }

            // Convert period to years for a consistent baseline
            let totalYears;
            switch (periodUnit) {
                case 'days': totalYears = period / 365; break;
                case 'weeks': totalYears = period / 52; break;
                case 'months': totalYears = period / 12; break;
                default: totalYears = period;
            }
            
            const periodsPerYear = { 'daily': 365, 'weekly': 52, 'monthly': 12, 'yearly': 1 }[compoundFrequency];
            const totalPeriods = Math.round(totalYears * periodsPerYear);
            const ratePerPeriod = annualRate / periodsPerYear;
            
            // Adjust monthly contribution to per-period contribution
            const contributionPerPeriod = (monthlyContribution * 12) / periodsPerYear;

            let balance = initial;
            let totalContributed = initial;
            const history = [];

            for (let i = 1; i <= totalPeriods; i++) {
                const interest = balance * ratePerPeriod;
                balance += interest + contributionPerPeriod;
                totalContributed += contributionPerPeriod;

                // Store data annually for the chart and table
                if (i % periodsPerYear === 0 || i === totalPeriods) {
                    const year = Math.ceil(i / periodsPerYear);
                    history.push({
                        period: year,
                        balance: balance,
                        totalContributed: totalContributed,
                        interestEarned: balance - totalContributed
                    });
                }
            }
            // Ensure the very first point is included
            history.unshift({
                period: 0,
                balance: initial,
                totalContributed: initial,
                interestEarned: 0
            });

            return history;
        }

        // --- UI UPDATE FUNCTIONS ---
        function updateUI(data) {
            if (!data || data.length === 0) return;

            // Update Chart
            chart.updateOptions({
                xaxis: {
                    categories: data.map(d => d.period)
                },
                series: [{
                    name: 'Balance Total',
                    data: data.map(d => d.balance.toFixed(2))
                }, {
                    name: 'Total Aportado',
                    data: data.map(d => d.totalContributed.toFixed(2))
                }]
            });

            // Update Table
            tableBody.innerHTML = '';
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-blue-50';
                row.innerHTML = `
                    <td class="p-3 text-sm text-gray-700">Año ${item.period}</td>
                    <td class="p-3 text-sm text-gray-700 text-right">$${formatCurrency(item.totalContributed)}</td>
                    <td class="p-3 text-sm text-green-600 font-semibold text-right">$${formatCurrency(item.interestEarned)}</td>
                    <td class="p-3 text-sm text-blue-800 font-bold text-right">$${formatCurrency(item.balance)}</td>
                `;
                tableBody.appendChild(row);
            });

            // Animate last row total
            const lastBalanceCell = tableBody.querySelector('tr:last-child td:last-child');
            if(lastBalanceCell) {
                const finalBalance = data[data.length - 1].balance;
                anime({
                    targets: { value: 0 },
                    value: finalBalance,
                    round: 100, // to 2 decimal places
                    easing: 'easeInOutExpo',
                    duration: 1500,
                    update: function(anim) {
                        lastBalanceCell.innerHTML = `$${formatCurrency(anim.animations[0].currentValue)}`;
                    }
                });
            }
        }

        function handleCalculation() {
            const results = calculateCompoundInterest();
            if (results) {
                updateUI(results);
            } else {
                // Clear UI if calculation fails
                chart.updateSeries([{ data: [] }, { data: [] }]);
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center p-4 text-gray-500">Ingresa datos válidos para ver los resultados.</td></tr>';
            }
        }

        // --- ACTION FUNCTIONS ---
        function resetForm() {
            initialInvestmentEl.value = '1000';
            monthlyContributionEl.value = '100';
            investmentPeriodEl.value = '10';
            periodUnitEl.value = 'years';
            interestRateEl.value = '7';
            compoundFrequencyEl.value = 'monthly';
            handleCalculation(); // Recalculate with default values
        }

        function exportToExcel() {
            const table = document.getElementById('results-table');
            const wb = XLSX.utils.table_to_book(table, { sheet: "Resultados" });
            XLSX.writeFile(wb, "Calculo_Interes_Compuesto.xlsx");
        }

        // --- INITIALIZATION ---
        runIntroAnimation();
        // Initial calculation on page load
        setTimeout(handleCalculation, 500); // Delay to allow intro to start
    });
    </script>
</body>
</html>
